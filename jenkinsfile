pipeline {
    agent any
    environment {
        AWS_REGION = "us-east-1"
        CLUSTER_NAME = "my-cluster"
        DOCKER_HUB = "yourdockerhub"
    }
    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/Hibalem/e-commerce.git'  // Your repo
            }
        }
        stage('Build and Push Docker Images') {
            steps {
                script {
                    sh 'docker build -t $DOCKER_HUB/user-service:v1 ./user-service'
                    sh 'docker push $DOCKER_HUB/user-service:v1'
                    sh 'docker build -t $DOCKER_HUB/product-service:v1 ./product-service'
                    sh 'docker push $DOCKER_HUB/product-service:v1'
                    sh 'docker build -t $DOCKER_HUB/order-service:v1 ./order-service'
                    sh 'docker push $DOCKER_HUB/order-service:v1'
                }
            }
        }
        stage('Deploy to Kubernetes') {
            steps {
                script {
                    sh 'aws eks update-kubeconfig --region $AWS_REGION --name $CLUSTER_NAME'
                    sh 'kubectl apply -f k8s/'  // Directory with YAMLs
                }
            }
        }
    }
}